# TDD Green阶段（实现）

执行TDD的Green阶段。

## 事前准备

进行开发上下文的准备：

**Task工具执行**: `/tdd-load-context` 进行TDD相关文件的读取和上下文准备

读取完成后，基于准备好的上下文信息开始Green阶段（实现）的工作。

**测试执行时使用Task工具**

## 可靠性水平指示

实现代码创建时，对于各实现内容与原始资料的对照状况，请用以下信号进行注释：

- 🟢 **绿色信号**: 参考原始资料几乎没有推测的情况
- 🟡 **黄色信号**: 从原始资料进行合理推测的情况
- 🔴 **红色信号**: 原始资料中没有的推测情况

## 目标

为了使Red阶段创建的测试通过，请进行**实现**。

## 实现原则

- **确实通过测试是最优先的**
- 代码美观度是次要的（在下一个Refactor阶段改善）
- "暂时能动"的水平即可
- 复杂逻辑放在后面，以简单实现为心
- 测试不容易通过时，使用Task工具调查失败原因后制定修正计划进行实现
- 既有测试出错的情况下，基于规格进行适当修正
- **Mock使用限制**: 不在测试代码以外描述Mock（实现代码写实际逻辑）
- **文件大小管理**: 实现文件超过800行时考虑文件分割
- NEVER: 禁止跳过必要测试
- NEVER: 禁止删除必要测试
- NEVER: 禁止在实现代码内描述Mock・Stub
- NEVER: 禁止在实现代码内使用代替DB的内存存储
- NEVER: 禁止在实现代码内省略DB操作

## 实现时的日语注释要求

实现代码必须包含以下日语注释：

### 函数・方法级别的注释

```javascript
/**
 * 【機能概要】: [用日语说明这个函数做什么]
 * 【実装方針】: [说明为什么选择这种实现方法]
 * 【テスト対応】: [明记为了通过哪个测试用例的实现]
 * 🟢🟡🔴 可靠性水平: [这个实现基于原始资料的程度]
 * @param {type} paramName - [参数说明]
 * @returns {type} - [返回值说明]
 */
function {{function_name}}(paramName) {
  // 【実装内容】: [实现处理的详细说明]
}
```

### 处理块级别的注释

```javascript
function processData(input) {
  // 【入力値検証】: [检查输入值有效性的理由和方法] 🟢🟡🔴
  if (!input) {
    throw new Error('輸入值不正確'); // 【エラー処理】: [说明为什么需要这个错误] 🟢🟡🔴
  }

  // 【データ処理開始】: [明示主处理的开始] 🟢🟡🔴
  // 【処理方針】: [说明这个处理如何为通过测试做贡献] 🟢🟡🔴
  const result = {
    // 【結果構造】: [说明返回值结构及其理由]
    validData: [],
    invalidData: [],
    errors: [],
  };

  // 【結果返却】: [说明返回处理结果的理由和内容]
  return result;
}
```

### 变量・常量的注释

```javascript
// 【定数定義】: [需要这个常量的理由和使用目的]
const MAX_FILE_SIZE = 1024 * 1024; // 【制限値】: 设置文件大小上限（1MB）

// 【変数初期化】: [说明为了通过测试为什么需要这个变量]
let processedCount = 0; // 【カウンタ】: 用于跟踪已处理文件数的计数器
```

### 错误处理的注释

```javascript
try {
  // 【実処理実行】: [实际处理执行部分的说明]
  const data = processFile(filePath);
} catch (error) {
  // 【エラー捕捉】: [错误发生时的对应方针]
  // 【テスト要件対応】: [为了满足测试中期望的错误处理的处理]
  return {
    success: false,
    error: error.message, // 【エラー情報】: 适当返回测试验证的错误消息
  };
}
```

## 实现示例

```javascript
/**
 * 【機能概要】: 验证JSON文件路径，分类有效/无效路径
 * 【実装方針】: 只实现通过测试用例的最低限度必要功能
 * 【テスト対応】: 为了通过tdd-red阶段创建的测试用例的实现
 */
function {{function_name}}(input) {
  // 【入力値検証】: 早期检测不正确的输入值以防止错误
  if (!input) {
    // 【エラー処理】: 对应测试期望的错误情况
    throw new Error('需要输入值');
  }

  // 【最小限実装】: 通过测试的最简单实现
  // 【ハードコーディング許可】: 由于预定在重构阶段改善，现阶段固定值即可
  return {{simple_return_value}};
}
```

## 阶段性实现指南

1. **首先只让一个测试用例通过**
   - 【実装戦略】: 避免多个测试的同时对应以防复杂化
   - 【品質確保】: 通过逐一确实实现来保证品质
2. **用最简单的方法实现**
   - 【シンプル実装】: 复杂算法在后续重构中添加
   - 【可読性重視】: 现阶段最优先考虑易理解性
3. **实现时注意文件大小**
   - 【800行制限】: 实现文件超过800行时考虑分割
   - 【モジュール設計】: 按功能单位适当分离文件
   - 【関数分割】: 将长大函数分割成小单位进行实现
   - 【責任境界】: 明确各文件的责任范围进行实现
   - 【分割戦略】: 按功能・层・域分离文件
4. **考虑代码质量标准**
   - 【静的解析対応】: 致力于不出现lint和typecheck错误的实现
   - 【フォーマット統一】: 符合项目既有格式的实现
   - 【命名規則遵守】: 遵循项目命名规则的实现
5. **把其他测试用例放在后面**
   - 【段階的開発】: 遵循TDD原则，逐步推进
   - 【影響範囲限定】: 将变更的影响抑制到最小
6. **错误处理也是最小限度**
   - 【必要最小限】: 只实现测试要求的部分
   - 【将来拡張可能】: 预定在重构阶段追加详细错误处理
7. **Mock使用限制**
   - 【実装コード制限】: 实现代码内不使用Mock・Stub
   - 【テストコード限定】: Mock只在测试代码内使用
   - 【実際のロジック実装】: 实现代码描述实际处理
   - 【依存関係注入】: 必要时用依赖性注入模式实现

## 请提供

1. **实现代码**: 通过测试的代码（附必须的日语注释）
2. **测试执行结果**: 使用Task工具确认测试实际通过
3. **实现说明**: 怎样的想法进行实现（与日语注释的对应关系）
4. **课题特定**: 当前实现的问题点（重构对象的明确化）
5. **文件大小检查**: 实现文件行数确认（800行超过时的分割计划）
6. **Mock使用确认**: 确认实现代码不包含Mock・Stub

实现完成后，请执行以下：

1. **备忘文件更新**: 更新docs/implements/{{task_id}}/{feature_name}-memo.md文件的Green阶段部分
   - 记录实现方针、实现代码、测试结果、课题・改善点
   - 详细记录以便下一个Refactor阶段参考
2. 将实现代码和设计内容保存到docs/implements/{{task_id}}/{feature_name}-green-phase.md（既有文件存在时追记）
3. 更新TODO状态（标记Green阶段完成）
4. **自动遷移判定**: 满足以下条件时自动执行 `/tdd-refactor`
   - 使用Task工具确认所有测试成功
   - 实现简单且易理解
   - 有明显的重构点
   - 没有功能问题
5. **手动确认**: 不满足自动迁移条件时请提供以下：
   - "使用Task工具确认测试通过了。"
   - "当前实现: [简洁说明]"
   - "实现中包含的日语注释: [注释的目的和内容]"
   - "重构候选: [应改善的点]"
   - "可以进行下一个Refactor阶段吗？"

## 质量判定基准

```
✅ 高质量:
- 测试结果: Task工具执行全部成功
- 实现质量: 简单且能动作
- 重构箇所: 能明确特定
- 功能问题: 无
- 编译错误: 无
- 文件大小: 800行以下或分割计划明确
- Mock使用: 实现代码不包含Mock・Stub

⚠️ 要改善:
- 部分测试失败（Task工具检测）
- 实现过于复杂
- 重构方针不明
- 功能有疑虑
- 存在编译错误
- 文件大小超过800行且分割计划不明
- 实现代码包含Mock・Stub
```

## TODO更新模式

```
- 将当前TODO「Green阶段（最小实现）」标记为「completed」
- 在TODO内容中反映最小实现阶段的完成
- 在TODO内容中记录质量判定结果
- 向TODO添加下一阶段「Refactor阶段（质量改善）」
```

下一步骤: `/tdd-refactor` 改善代码质量。