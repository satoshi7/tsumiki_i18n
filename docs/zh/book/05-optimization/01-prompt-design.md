# 5.1 有效提示设计的原则

## 引言

在 AITDD 中，AI 的输出质量很大程度上取决于提示设计。通过适当的提示设计，我们可以实现 AI 生成代码的质量提升和开发效率的最大化。本章将学习实践性的提示设计原则和具体方法。

## 提示设计的基本原则

### 1. 采用迭代改进方式

在 AITDD 中，不是期望一次提示创建就获得完美结果，而是以持续改进为前提进行设计。

**基本循环：**
```
提示创建 → 执行 → 结果评估 → 修改 → 重新执行
```

**实践要点：**
- 首次以 80% 的质量为目标，不追求完美
- 详细分析每次执行结果，识别改进点
- 通过积累小的修改来实现优化
- 记录改进日志，掌握模式

### 2. 融入置信度评估

让 AI 评估自己输出的置信度，可以高效地识别需要审查的地方。

**置信度指标：**
- **🟢 高置信度**：可以从参考文件中明确推导
- **🟡 中置信度**：基于合理推测但需要确认
- **🔴 需要判断**：基于独立判断生成，需要重点确认

### 3. 分步骤定制

为 TDD 的每个步骤（Red、Green、Refactor、Validation）优化提示。

**各步骤的特征：**
- **Red**：重视测试创建的明确性和全面性
- **Green**：最小实现和防止意外更改
- **Refactor**：质量提升和功能保持的平衡
- **Validation**：综合质量检查和问题发现

## AITDD 中的提示模式

### 模式1：TODO 记录指示

让 AI 以 TODO 格式记录生成结果中应确认项目的模式。

**基本模板：**
```markdown
## 提示中的指示示例

执行以下处理，并将结果记录为 TODO 列表：

**执行内容：**
[具体的指示内容]

**TODO 记录格式：**
```markdown
## [步骤名]结果 TODO

### 🟢 高置信度项目
- [ ] [文件名](相对路径) 的具体确认内容

### 🟡 中置信度项目  
- [ ] [文件名](相对路径) 的推测内容的合理性确认

### 🔴 需要判断的项目
- [ ] 详细确认：[文件名](相对路径) 的组织特定内容
```

**参考文件：** [指定文件的列表]
**输出文件：** `./todos/[步骤名]-check.md`
```

### 模式2：置信度评估指示

让 AI 明确生成内容的依据和置信度的模式。

**基本模板：**
```markdown
## 置信度评估指示

对每个生成内容，请根据以下标准评估置信度：

**评估标准：**
- 🟢 绿灯：可以从参考文件明确推测
- 🟡 黄灯：合理推测但需要确认
- 🔴 红灯：基于独立判断生成

**评估对象：**
1. 生成代码的各个功能
2. 测试用例的选择理由
3. 实现方针的决定依据

**输出格式：**
- 为每个项目添加信号灯标记
- 明确记载作为依据的参考文件位置
- 简洁说明推测理由
```

### 模式3：渐进式细化指示

用于逐步推进复杂实现的模式。

**基本模板：**
```markdown
## 渐进式实现指示

请按以下顺序逐步进行实现：

**第1阶段：基本结构**
- 最小限度的操作确认
- 主要函数/类的框架
- 基本测试用例

**第2阶段：功能扩展**
- 具体功能实现
- 错误处理
- 追加测试用例

**第3阶段：优化**
- 性能改进
- 代码质量提升
- 综合测试

**每个阶段后的确认：**
- 测试执行结果报告
- 执行置信度评估
- 整理下一阶段的课题
```

## 实践性的提示构成要素

### 必需要素清单

创建提示时必须包含的要素：

- [ ] **明确的目的定义**
  - 清楚说明想要实现什么
  - 期望输出的具体格式

- [ ] **参考文件的指定**
  - 明确列出作为依据的文件
  - 说明文件之间的关系

- [ ] **置信度评估指示**
  - 应用信号灯系统的指示
  - 明确定义评估标准

- [ ] **输出格式的指定**
  - 指定文件名和保存位置
  - 详细指定 markdown 格式等

- [ ] **约束和注意事项的明记**
  - 不应更改的部分
  - 特别的考虑事项

### 可模板化的部分

**标准头部示例：**
```markdown
## [步骤名] 执行指示

**目的：** [具体目的]
**参考文件：** [文件列表]
**输出文件：** [保存路径]

**置信度评估：**
对每个生成内容用 🟢🟡🔴 显示置信度

**约束事项：**
- [重要约束事项]
```

### 需要定制的部分

应根据项目定制的要素：

1. **领域特定的术语和概念**
   - 行业特定术语的定义
   - 项目内的命名规则

2. **技术栈特定的约束**
   - 使用框架的约束
   - 性能要求

3. **组织特定的规则**
   - 编码规范
   - 安全指南

## 质量保证的提示技巧

### 1. 防止意外实现

**对策技巧：**
```markdown
## 实现约束的明确化

**更改许可范围：**
- 可更改：[具体的文件/函数名]
- 禁止更改：[现有的正常运行部分]

**实现方针：**
- 以最小更改实现目的
- 最小化对现有功能的影响
- 以新增为基本，现有修改最小化

**确认检查：**
- [ ] 是否包含指定范围外的更改
- [ ] 现有测试是否继续成功
- [ ] 是否发生意外的副作用
```

### 2. 明确与参考源文件的关系

**关系明确化示例：**
```markdown
## 参考文件关系图

**主要参考：**
- `spec.md` → 需求定义的依据
- `existing_test.js` → 现有规范的确认
- `config.json` → 配置规范的参考

**派生参考：**
- `utils.js` → 现有工具的利用
- `types.ts` → 确保类型定义的一致性

**生成时的参考优先级：**
1. 主要参考最优先
2. 冲突内容采用主要参考
3. 不明确的点作为问题明确记录
```

### 3. 渐进式细化的实现

**细化策略：**
```markdown
## 渐进式细化过程

**第1级：骨架创建**
- 接口定义
- 主要函数签名
- 基本错误处理

**第2级：功能实现**
- 业务逻辑实现
- 详细错误处理
- 输入值验证

**第3级：优化和完成**
- 性能优化
- 边缘情况处理
- 文档整理

**各级别的确认项目：**
- 测试执行结果
- 置信度评估
- 下一级别的课题
```

## 实践练习

### 练习1：创建基本提示

请为以下场景创建提示：

**场景：** 用户认证功能的测试用例创建
**参考文件：** `auth_spec.md`、`user_model.js`
**期望输出：** Jest 格式的测试文件

**应创建的要素：**
1. 明确的目的定义
2. 参考文件的指定
3. 置信度评估的指示
4. 输出格式的指定

### 练习2：设计渐进式实现提示

**场景：** REST API 端点的实现
**要求：** 包含复杂的数据处理
**约束：** 利用现有的中间件

**应设计的要素：**
1. 3个实现阶段
2. 各阶段的成果物
3. 阶段间的确认项目

## 总结

有效提示设计的核心如下：

1. **迭代改进**：不要一次追求完美，以持续改进为前提
2. **置信度评估**：可视化 AI 的推测部分，实现高效审查
3. **分步骤优化**：根据 TDD 的各个阶段进行提示设计
4. **质量控制**：防止意外实现和明确参考源

在下一节中，我们将详细学习具体利用这些原则的 AI 推理可视化技术。