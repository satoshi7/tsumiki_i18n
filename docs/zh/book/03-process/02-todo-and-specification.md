# 3.2 TODO创建和规范制定

## TODO创建：开发的起点

### TODO的重要性

在AITDD中，适当的TODO创建是成功的关键。模糊的TODO会对后续所有步骤产生负面影响，因此创建明确且可执行的TODO非常重要。

### 有效TODO创建的原则

#### 1. 确保具体性
```markdown
❌ 不好的例子："创建用户管理功能"
✅ 好的例子："实现用户注册功能（email/password认证）"
```

#### 2. 适当的粒度
- **过大**：一个TODO包含多个功能
- **过小**：单个方法单位
- **适当**：一个完整的功能单位

#### 3. 明确完成条件
```markdown
## TODO: 实现用户注册API

### 完成条件
- [ ] POST /api/users 端点实现
- [ ] email/password验证
- [ ] 密码哈希化
- [ ] 数据库保存
- [ ] 响应格式统一
```

### TODO管理文件结构

#### 基本格式

```markdown
# 项目TODO管理

## 计划实现
### 高优先级
- [ ] **用户认证功能**
  - 说明：使用JWT认证的认证功能
  - 完成条件：登录/登出/令牌验证
  - 依赖：数据库设计完成

### 中优先级
- [ ] **商品搜索功能**
  - 说明：通过关键词和类别搜索商品
  - 完成条件：搜索API + 过滤功能

## 进行中
- [x] 数据库设计（2024-06-21 完成）

## 已完成
- [x] 项目初始设置（2024-06-20 完成）
```

#### 推荐文件结构

```
doc/
├── todo.md                    # 主要TODO管理
├── implementation/
│   ├── user-auth-requirements.md      # 单个功能的详细规范
│   ├── user-auth-testcases.md         # 测试用例
│   └── search-requirements.md
└── archive/
    └── completed-todos.md              # 已完成TODO的存档
```

## 规范制定：设计的基础

### 规范制定的目的

从TODO制定具体的技术规范，明确实现方向。这个阶段的模糊性会在后续步骤中成为大问题，因此详细考虑很重要。

### 规范书模板

```markdown
# [功能名] 需求定义书

## 概述
简洁描述功能的目的和概述

## 功能需求

### 基本功能
- 必须的基本功能

### 详细规范
- 输入项目和验证
- 处理流程
- 输出格式

### 非功能需求
- 性能需求
- 安全需求
- 可用性需求

## 技术规范

### API规范
- 端点
- 请求/响应格式
- 状态码

### 数据库设计
- 表设计
- 索引
- 约束

### 错误处理
- 错误情况定义
- 错误消息
- 日志输出方针

## 约束条件
- 技术约束
- 业务约束
- 外部依赖

## 参考资料
- 相关文档
- 外部API规范书
```

### 具体的规范制定例子

#### 例子：用户注册功能规范

```markdown
# 用户注册功能 需求定义书

## 概述
新用户可以通过email和password注册的功能

## 功能需求

### 基本功能
- 通过email/password进行新用户注册
- 重复email验证
- 密码强度检查

### 详细规范

#### 输入项目
- **email**：必须，email格式，最大254字符
- **password**：必须，8字符以上，包含英数字符号
- **password_confirmation**：必须，与password一致

#### 验证
- email重复检查（数据库确认）
- 密码强度（包含大写/小写/数字/符号）
- CSRF令牌验证

#### 处理流程
1. 输入值验证
2. email重复检查
3. 密码哈希化（bcrypt）
4. 数据库保存
5. 返回成功响应

### 非功能需求
- 响应时间：2秒以内
- 并发注册：支持100件/秒
- 密码哈希化必须

## 技术规范

### API规范
```
POST /api/users
Content-Type: application/json

Request:
{
  "email": "user@example.com",
  "password": "SecurePass123!",
  "password_confirmation": "SecurePass123!"
}

Response (201):
{
  "id": 123,
  "email": "user@example.com",
  "created_at": "2024-06-21T10:00:00Z"
}

Response (400):
{
  "error": "validation_failed",
  "details": [
    {
      "field": "email",
      "message": "Email already exists"
    }
  ]
}
```

### 数据库设计
```sql
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  email VARCHAR(254) UNIQUE NOT NULL,
  password_hash VARCHAR(255) NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_users_email ON users(email);
```

### 错误处理
- **400**：验证错误，重复email
- **429**：速率限制
- **500**：服务器错误

## 约束条件
- 禁止密码明文保存
- 本次不包含email确认功能
- 本次不包含社交登录
```

## 人工审查要点

### 检查项目

#### 1. 完整性确认
- [ ] 是否包含所有必要功能？
- [ ] 是否考虑了边缘情况？
- [ ] 错误处理是否充分？

#### 2. 可实现性验证
- [ ] 技术上是否可以实现？
- [ ] 性能需求是否现实？
- [ ] 安全需求是否适当？

#### 3. 一致性确认
- [ ] 与其他功能的一致性
- [ ] 数据设计的一致性
- [ ] API接口的统一性

#### 4. 可维护性考虑
- [ ] 未来的扩展性
- [ ] 测试的容易性
- [ ] 文档化的容易性

### 审查时的注意点

#### 使用AI建议时的注意
- AI建议作为参考使用
- 最终判断必须由人类进行
- 项目特有需求由人类添加

#### 阶段性详细化
```
1. 概述级别规范 → 审查
2. 添加详细规范 → 审查
3. 制定技术规范 → 审查
4. 最终确认 → 批准
```

## 规范制定的最佳实践

### 1. 明确无歧义的表达
```markdown
❌ "适当处理"
✅ "错误时返回400状态码和错误消息"
```

### 2. 明记具体数值
```markdown
❌ "高速处理"
✅ "2秒内返回响应"
```

### 3. 明确约束条件
```markdown
❌ "考虑安全性"
✅ "密码用bcrypt哈希化，禁止明文保存"
```

### 4. 考虑可测试性
- 确认各规范项目是否可测试
- 考虑测试数据准备方法
- 考虑mock和stub的必要性

## 向下一步的准备

规范制定完成后，接下来进行[测试用例创建](./03-test-case-creation.md)。

### 成果物确认
- [ ] TODO.md已适当更新
- [ ] requirements.md已详细创建
- [ ] 规范中没有遗留模糊部分
- [ ] 人工审查已完成

### 常见问题和对策

#### 规范仍然模糊
**对策**：必须实施人工审查，当场解决疑问点

#### 过度依赖AI建议
**对策**：AI建议仅作参考，最终判断由人类进行

#### 遗漏非功能需求
**对策**：使用检查清单进行系统性审查

适当的规范制定确保后续测试用例创建和实现的顺利进行。